round(quantile(NewHomes_pct,
probs = seq(0,0.8,by=.2),
na.rm = TRUE)),
"-",
round(quantile(NewHomes_pct,
probs = seq(0.2,1,by=.2),
na.rm = TRUE))))),
color = "NA") +
coord_sf(crs = "EPSG:32618") +
scale_fill_viridis_d(name = "% of Total \nHousing Units",
direction = 1,
option = "cividis",
na.value = "grey90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# see new construction
ggplot(data = data_NYC) +
geom_sf(aes(fill = cut(NewHomes_pct,
breaks = quantile(NewHomes_pct,
probs = seq(0,1,by=.2),
na.rm=TRUE),
include.lowest = TRUE,
labels = paste0(
round(quantile(NewHomes_pct,
probs = seq(0,0.8,by=.2),
na.rm = TRUE)),
"-",
round(quantile(NewHomes_pct,
probs = seq(0.2,1,by=.2),
na.rm = TRUE))))),
color = "NA") +
coord_sf(crs = "EPSG:32618") +
scale_fill_viridis_d(name = "% of Total \nHousing Units",
direction = 1,
option = "cividis",
na.value = "grey90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# see new construction
ggplot(data = data_NYC) +
geom_sf(aes(fill = cut(NewHomes_pct,
breaks = quantile(NewHomes_pct,
probs = seq(0,1,by=.25),
na.rm=TRUE),
include.lowest = TRUE,
labels = paste0(
round(quantile(NewHomes_pct,
probs = seq(0,0.8,by=.2),
na.rm = TRUE)),
"-",
round(quantile(NewHomes_pct,
probs = seq(0.2,1,by=.2),
na.rm = TRUE))))),
color = "NA") +
coord_sf(crs = "EPSG:32618") +
scale_fill_viridis_d(name = "% of Total \nHousing Units",
direction = 1,
option = "cividis",
na.value = "grey90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# see new construction
ggplot(data = data_NYC) +
geom_sf(aes(fill = cut(NewHomes_pct,
breaks = quantile(NewHomes_pct,
probs = seq(0,1,by=.2),
na.rm=TRUE),
include.lowest = TRUE,
labels = paste0(
round(quantile(NewHomes_pct,
probs = seq(0,0.8,by=.2),
na.rm = TRUE)),
"-",
round(quantile(NewHomes_pct,
probs = seq(0.2,1,by=.2),
na.rm = TRUE))))),
color = "NA") +
coord_sf(crs = "EPSG:32618") +
scale_fill_viridis_d(name = "% of Total \nHousing Units",
direction = 1,
option = "cividis",
na.value = "grey90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
library(tmap)
tm_shape(data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "quantile",
title = "Supply Factors"
)
tm_shape(shp = data_NYC,
name = "Demand Factors"
) +
tm_polygons(fill = "NewHomes_pct",
style = "quantile",
title = "Supply Factors"
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "quantile",
palette = "Greens",
title = "Supply Factors"
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "quantile",
palette = "Greens",
title = "Supply Factors") +
tm_layout(
title = "Supply Factors",
title.size = 1.5,
title.position = c("center", "top"),
main.title = "New construction as a share of housing market, 2020-2023",
main.title.size = 1.2
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "quantile",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.5,
title.position = c("center", "top"),
main.title = "New construction as a share of housing market, 2020-2023",
main.title.size = 1.2
)
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# define a list of variables, including more intuitive names
variables <- c(MedianConRent = "B25058_001",
HouseUnits_sum = "B25002_001",
HouseUnits_built2020orlater = "B25034_002",
OccupiedHouseUnits_sum = "B25038_001",
Owner_MovedIn_after2021 = "B25038_003",
Renter_MovedIn_after2021 = "B25038_010"
)
# query API again, for all census tracts within one borough
data_NYC <- get_acs(
geography = "tract",     # census tracts
state = "New York",
county = "Kings",
variables = variables,   # variables previously defined
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE          # include spatial boundary data
)
# and do the same data cleaning as before
data_NYC <- data_NYC %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# and calculate some descriptive statistics just to verify it worked
mean(na.omit(data_NYC$MedianConRent))
mean(na.omit(data_NYC$NewHomes_pct))
mean(na.omit(data_NYC$NewComers_pct))
# median rent for one borough
ggplot(data = data_NYC) +
geom_sf(aes(fill = MedianConRent), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Reds",
direction = 1,
name = "Rent ($)",
na.value = "gray90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.5,
title.position = c("center", "top"),
main.title = "New construction as a share of housing market, 2020-2023",
main.title.size = 1.2
)
library(tmap)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.5,
title.position = c("center", "top"),
main.title = "New construction as a share of housing market, 2020-2023",
main.title.size = 1.2
)
library(tmap)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.5,
title.position = c("left", "top"),
main.title = "New construction as a share of housing market, 2020-2023",
main.title.size = 1.2
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.2,
title.position = c("left", "top"),
main.title = "New construction \nas a share of \nhousing market, 2020-2023",
main.title.size = 1.2
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "Supply Factors",
title.size = 1.2,
title.position = c("left", "top"),
main.title = "New construction \nas a share of \nhousing market, 2020-2023",
main.title.size = .9
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "New construction \nas a share of \nhousing market, \n2020-2023",
title.size = 1,
title.position = c("left", "top"),
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "New construction \nas a share of \nhousing market, \n2020-2023",
title.size = .9,
title.position = c("left", "top"),
)
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "New construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"),
)
# switch over to a library called tmap for the last few
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units") +
tm_layout(
title = "New Construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"),
)
# switch over to a library called tmap for the last few
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units",
title.size = .7) +
tm_layout(
title = "New Construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"),
)
# see new construction
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewComers_pct",
style = "jenks",
palette = "Purples",
title = "% of Occupied \nHousing Units",
title.size = .7) +
tm_layout(
title = "Recent Movers\n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# switch over to a library called tmap for the last few maps
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
title = "% of Total \nHousing Units",
na.values = "gray90",
title.size = .7) +
tm_layout(
title = "New Construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# see new construction
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewComers_pct",
style = "jenks",
palette = "Purples",
na.values = "gray90",
title = "% of Occupied \nHousing Units",
title.size = .7) +
tm_layout(
title = "Recent Movers\n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# see new construction
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewComers_pct",
style = "jenks",
palette = "Purples",
colorNA = "gray90",
title = "% of Occupied \nHousing Units",
title.size = .7) +
tm_layout(
title = "Recent Movers\n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# see new construction
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewComers_pct",
style = "jenks",
palette = "Purples",
colorNA = "gray90",
title = "% of Occupied \nHousing Units",
title.size = .7) +
tm_layout(
title = "Recent Movers\n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
library(tmap)       # for custom mapping
library(biscale)    # for one very specific mapping technique
install.packages("biscale")
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
library(tmap)       # for custom mapping
library(biscale)    # for one very specific mapping technique
# and, finally, let's map the two variables together
# prep data for bivariate visualization
bivariate_supply <- bi_class(data_NYC,
x = NewHomes_pct,
y = MedianConRent,
style = "quantile",
dim = 3)
# and, finally, let's map the two variables together
# prep data for bivariate visualization
bivariate_supply <- bi_class(data_NYC,
x = NewHomes_pct,
y = MedianConRent,
style = "quantile",
dim = 3)
# and, finally, let's map the two variables together
# prep data for bivariate visualization
bivariate_supply <- bi_class(data_NYC,
x = NewHomes_pct,
y = MedianConRent,
style = "jenks",
dim = 3)
ggplot(data = bivariate_supply) +
geom_sf(aes(fill = bivariate_supply),
color = NA,
show.legend = FALSE) +
coord_sf(crs = "EPSG:32618") +
bi_scale_fill(pal = "PinkGrn", dim = 3) +
labs(
title = "Demand Factors",
subtitle = "Residents who recently moved into their home, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# create a scatterplot for new housing
ggplot(data = data,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# switch over to a library called tmap for the last few maps
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
border.alpha = 0,
colorNA = "gray90",
title = "% of Total \nHousing Units",
title.size = .7) +
tm_layout(
title = "New Construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# see new construction
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewComers_pct",
style = "jenks",
palette = "Purples",
border.alpha = 0,
colorNA = "gray90",
title = "% of Occupied \nHousing Units",
title.size = .7) +
tm_layout(
title = "Recent Movers\n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# median rent for one borough
ggplot(data = data_NYC) +
geom_sf(aes(fill = MedianConRent), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Reds",
direction = 1,
name = "Rent ($)",
na.value = "gray90") +
labs(
title = "Median Contract Rent",
subtitle = "By census tract in Brooklyn, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# switch over to a library called tmap for the last few maps
tm_shape(shp = data_NYC) +
tm_polygons(fill = "NewHomes_pct",
style = "jenks",
palette = "Greens",
border.alpha = 0,
colorNA = "gray90",
title = "% of Total \nHousing Units",
title.size = .7) +
tm_layout(
title = "New Construction \n2020-2023",
title.size = .9,
title.position = c("left", "top"))
# create a scatterplot for new housing
ggplot(data,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# set up an API query
data <- get_acs(geography = "county",    # all counties in the US
variables = variables,   # all variables defined in the list above
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE         # include spatial boundary data
)
# use dplyr tools to clean the data
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
