x = "New Homes (%)",
size = "Total Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# define a regression model for new construction
lm(formula = MedianConRent ~ NewHomes_pct, data = data)
# define a regression model for recent movers
lm(formula = MedianConRent ~ NewComers_pct, data = data)
# query API again, for all census tracts within one borough
data_NYC <- get_acs(
geography = "tract",     # census tracts
state = "New York",
county = c("Bronx", "Kings", "New York", "Queens", "Richmond"),
variables = variables,   # variables previously defined
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE          # include spatial boundary data
)
# and do the same data cleaning as before
data_NYC <- data_NYC %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# query API again, for all census tracts within one borough
data <- get_acs(
geography = "tract",     # census tracts
state = "New York",
county = c("Bronx", "Kings", "New York", "Queens", "Richmond"),
variables = variables,   # variables previously defined
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE          # include spatial boundary data
)
# and do the same data cleaning as before
data <- data_NYC %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(data$NewHomes_pct)
mean(data$NewComers_pct)
# see the total rows and columns of the data
dim(data)
#list the column names
ls(data)
# use dplyr tools to clean the data
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(data$NewHomes_pct)
mean(data$NewComers_pct)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct))
# now map median rent
ggplot(data = data) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "ESRI:102010") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# now map new home construction
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "ESRI:102010") +
scale_fill_distiller(palette = "Greens",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# create a scatterplot for new housing
ggplot(data = data,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
library(tmap)       # for custom mapping
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# query metadata from the api, naming the year and data product
# parameter options available at https://walker-data.com/tidycensus/articles/basic-usage.html#searching-for-variables
variablelist <- load_variables(year= 2023, dataset = "acs5")
# define a list of variables, including more intuitive names
variables <- c(MedianConRent = "B25058_001",
HouseUnits_sum = "B25002_001",
HouseUnits_built2020orlater = "B25034_002",
OccupiedHouseUnits_sum = "B25038_001",
Owner_MovedIn_after2021 = "B25038_003",
Renter_MovedIn_after2021 = "B25038_010"
)
# query API again, for all census tracts within one borough
data <- get_acs(
geography = "tract",     # all census tracts within state and county
state = "New York",
county = c("Bronx", "Kings", "New York", "Queens", "Richmond"),
variables = variables,   # variables previously defined
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE          # include spatial boundary data
)
# and do the same data cleaning as before
data <- data_NYC %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# and do some data cleaning
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct)
# calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct))
# see the total rows and columns of the data
dim(data)
#list the column names
ls(data)
# use dplyr tools to clean the data
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct))
# map median rent
ggplot(data = data) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "EPSG:32618") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent in NYC, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# now map new home construction
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Greens",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# now map recent movers
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "ESRI:102010") +
scale_fill_distiller(palette = "Purples",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Demand Factors",
subtitle = "Residents who recently moved into their home, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# now map recent movers
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Purples",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Demand Factors",
subtitle = "Residents who recently moved into their home, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# Step 1: Load required package
library(classInt)
# Step 2: Compute Jenks breaks
jenks_breaks <- classIntervals(data$NewHomes_pct, n = 5, style = "jenks")$brks
# Step 3: Bin the data using Jenks breaks
data$NewHomes_pct_jenks <- cut(
data$NewHomes_pct,
breaks = jenks_breaks,
include.lowest = TRUE,
dig.lab = 6
)
# Step 4: Plot using Jenks bins
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct_jenks), color = NA) +
coord_sf(crs = "EPSG:32618") +
scale_fill_brewer(
palette = "Greens",
direction = 1,
name = "% of Total House Units",
na.value = "gray90"
) +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020â€“2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# now map new home construction
ggplot(data = data) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Greens",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# create a scatterplot for new housing
ggplot(data = data,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# define a regression model for new construction
lm(formula = MedianConRent ~ NewHomes_pct, data = data)
# define a regression model for recent movers
lm(formula = MedianConRent ~ NewComers_pct, data = data)
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
library(tmap)       # for custom mapping
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# define a list of variables, including more intuitive names
variables <- c(MedianConRent = "B25058_001",
HouseUnits_sum = "B25002_001",
HouseUnits_built2020orlater = "B25034_002",
OccupiedHouseUnits_sum = "B25038_001",
Owner_MovedIn_after2021 = "B25038_003",
Renter_MovedIn_after2021 = "B25038_010"
)
# set up an API query
data <- get_acs(geography = "county",    # all counties in the US
variables = variables,   # all variables defined in the list above
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE         # include spatial boundary data
)
# see the total rows and columns of the data
dim(data)
#list the column names
ls(data)
# use dplyr tools to clean the data
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct))
# first we'll drop Alaska, Hawaii, and overseas territories to map only the lower 48 states
## FIPS codes to exclude
exclude_list <- c("02", "15", "60", "66", "69", "72", "78")
# filter the data
lower48 <- data %>%
filter(!str_sub(GEOID, 1, 2) %in% exclude_list)
# now map median rent
ggplot(data = data) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "ESRI:102010") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# now map median rent
ggplot(data = lower48) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "ESRI:102010") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# now map new home construction
ggplot(data = lower48) +
geom_sf(aes(fill = NewHomes_pct), color = NA) +  # Changed the variable
coord_sf(crs = "ESRI:102010") +
scale_fill_distiller(palette = "Greens",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Supply Factors",
subtitle = "New construction as a share of housing market, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# now map recent movers
ggplot(data = lower48) +
geom_sf(aes(fill = NewComers_pct), color = NA) +  # Changed the variable
coord_sf(crs = "ESRI:102010") +
scale_fill_distiller(palette = "Purples",
direction = 1,
name = "% of Total House Units",
na.value = "gray90") +
labs(
title = "Demand Factors",
subtitle = "Residents who recently moved into their home, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# create a scatterplot for new housing
ggplot(data = data,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# define a regression model for new construction
lm(formula = MedianConRent ~ NewHomes_pct, data = data)
# define a regression model for recent movers
lm(formula = MedianConRent ~ NewComers_pct, data = data)
# add model for new housing
ggplot(data = data,
aes(x = NewHomes_pct, y = MedianConRent)) +
geom_point(color = "green", alpha = .5) +
geom_smooth(method = "lm",  # use y ~ x
level = 0.95,   # confidence interval around the line
color = "red"
) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes as percent of market",
size = "Total Housing Units"
)
# create a scatterplot for recent movers
ggplot(data = data, aes(x = NewComers_pct, y = MedianConRent)) +
geom_point(color = "purple", alpha = .5) +
geom_smooth(method = "lm",  # use y ~ x
level = 0.95,   # confidence interval around the line
color = "orange"
) +
labs(
title = "Does in-migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Total Housing Units"
)
# correlation between rent and new construction
cor.test(x = data$NewHomes_pct,   # x variable
y = data$MedianConRent,  # y variables
method = "pearson",      # correlation method
use = "complete.obs")    # exclude rows with null values
# correlation between rent and recent movers
cor.test(x = data$NewComers_pct,
y = data$MedianConRent,
method = "pearson",
use = "complete.obs")
