)
# create a scatterplot for recent movers
ggplot(data = data, aes(x = NewComers_pct, y = MedianConRent)) +
geom_point(color = "purple", alpha = .5) +
geom_smooth(method = "lm",  # use y ~ x
level = 0.95,   # confidence interval around the line
color = "orange"
) +
labs(
title = "Does in-migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Total Housing Units"
)
# correlation between rent and new construction
cor.test(x = data$NewHomes_pct,   # x variable
y = data$MedianConRent,  # y variables
method = "pearson",      # correlation method
use = "complete.obs")    # exclude rows with null values
# correlation between rent and recent movers
cor.test(x = data$NewComers_pct,
y = data$MedianConRent,
method = "pearson",
use = "complete.obs")
# set your API key
census_api_key("your key here")
# now load the libraries
library(dplyr)      # for managing data tables
library(ggplot2)    # for data visualization
library(stringr)    # for filtering string columns
library(tidycensus) # for using the Census API
# set your API key
census_api_key("fd874e212346a3d3f3e27fce3fb3cc7dfce3c4e1")
# define a list of variables, including more intuitive names
variables <- c(MedianConRent = "B25058_001",
HouseUnits_sum = "B25002_001",
HouseUnits_built2020orlater = "B25034_002",
OccupiedHouseUnits_sum = "B25038_001",
Owner_MovedIn_after2021 = "B25038_003",
Renter_MovedIn_after2021 = "B25038_010"
)
# set up an API query
data <- get_acs(geography = "county",    # all counties in the US
variables = variables,   # all variables defined in the list above
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE         # include spatial boundary data
)
# use dplyr tools to clean the data
data <- data %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# now we'll calculate some descriptive statistics just to verify it worked
mean(na.omit(data$MedianConRent))
mean(na.omit(data$NewHomes_pct))
mean(na.omit(data$NewComers_pct))
# first we'll drop Alaska, Hawaii, and overseas territories to map only the lower 48 states
## FIPS codes to exclude
exclude_list <- c("02", "15", "60", "66", "69", "72", "78")
# filter the data
lower48 <- data %>%
filter(!str_sub(GEOID, 1, 2) %in% exclude_list)
# now map median rent
ggplot(data = lower48) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "ESRI:102010") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +  # defines the plot spac
geom_histogram(
binwidth = 100,
fill = "red",
color = "gray50") +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +  # defines the plot spac
geom_histogram(
binwidth = 50,
fill = "red",
color = "gray50") +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# first we'll drop Alaska, Hawaii, and overseas territories to map only the lower 48 states
## FIPS codes to exclude
exclude_list <- c("02", "15", "60", "66", "69", "72", "78")
# filter the data
lower48 <- data %>%
filter(!str_sub(GEOID, 1, 2) %in% exclude_list)
# now map median rent
ggplot(data = lower48) +  # defines the plot space
geom_sf(aes(fill = MedianConRent), color = NA) +  # viz type = map
coord_sf(crs = "ESRI:102010") +   # a relevant map projection for the region
scale_fill_distiller(palette = "Reds", # define color fill
direction = 1,  # ramp from light to dark
name = "Rent ($)",  # label the legend
na.value = "gray90") + # color for nulls
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()  # choose a theme
# set up an API query
data_NYC <- get_acs(geography = "tract",    # census tracts
state = "New York",     # now we specify a geographic search
county = "Kings",
variables = variables,   # all variables defined in the list above
output = "wide",         # row = observation, column = variable
year = 2023,             # most recent year
geometry = TRUE         # include spatial boundary data
)
# do the same cleaning as before
data_NYC <- data_NYC %>%
rename_with(~ gsub("E$", "", .x), .cols = everything()) %>%
mutate(
NewHomes_pct =  (HouseUnits_built2020orlater / HouseUnits_sum) * 100,
NewComers_pct = (Owner_MovedIn_after2021+ Renter_MovedIn_after2021) /
OccupiedHouseUnits_sum * 100)
# and calculate descriptive statistics just to verify it worked
mean(na.omit(data_NYC$MedianConRent))
mean(na.omit(data_NYC$NewHomes_pct))
mean(na.omit(data_NYC$NewComers_pct))
# median rent for one borough
ggplot(data = data_NYC) +
geom_sf(aes(fill = MedianConRent), color = NA) +  # Changed the variable
coord_sf(crs = "EPSG:32618") +
scale_fill_distiller(palette = "Reds",
direction = 1,
name = "Rent ($)",
na.value = "gray90") +
labs(
title = "Median Contract Rent",
subtitle = "By census tract in Brooklyn, 2020-2023",
caption = "Source: ACS 5 Year Estimates"
) +
theme_minimal()
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent, # y variable
size = HouseUnits_sum)) +   # size dots by total population, for context
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent) + # y variable
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent)) + # y variable
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
)
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
View(data_NYC)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent,
size = HouseUnits_sum)) +
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent,  # y variable
size = HouseUnits_sum)) +   # size of bubble, just for contet
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Housing Units"
)
# correlation between rent and new construction
cor.test(x = data_NYC$NewHomes_pct,   # x variable
y = data_NYC$MedianConRent,  # y variables
method = "pearson",      # correlation method
use = "complete.obs")    # exclude rows with null values
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
subtitle = "In Brooklyn, 2020-2023"
y = "Median Contract Rent ($)",
# create a scatterplot for recent movers
ggplot(data = data,   # define the data space
aes(x = NewComers_pct,  # x variable
y = MedianConRent, # y variable
size = OccupiedHouseUnits_sum)) +
geom_point(color = "purple", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does migration relate to median rent?",
subtitle = "In Brooklyn, 2020-2023",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)",
size = "Occupied Housing Units"
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent,  # y variable
size = HouseUnits_sum)) +   # size of bubble, just for contet
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
subtitle = "In Brooklyn, 2020-2023",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Housing Units"
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent,  # y variable
size = HouseUnits_sum)) +   # size of bubble, just for contet
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
subtitle = "In Brooklyn, 2020-2023",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total /nHousing Units"
)
# create a scatterplot for new housing
ggplot(data = data_NYC,   # define the data space
aes(x = NewHomes_pct,  # x variable
y = MedianConRent,  # y variable
size = HouseUnits_sum)) +   # size of bubble, just for contet
geom_point(color = "green", # color as name or RBG vector
alpha = .5) +  # transparency
scale_size_continuous(labels = scales::comma) +
labs(
title = "Does new construction relate to median rent?",
subtitle = "In Brooklyn, 2020-2023",
y = "Median Contract Rent ($)",
x = "New Homes (%)",
size = "Total Housing Units"
)
# correlation between rent and recent movers
cor.test(x = data_NYC$NewComers_pct,
y = data_NYC$MedianConRent,
method = "pearson",
use = "complete.obs")
# define a regression model for new construction
lm(formula = MedianConRent ~ NewHomes_pct, data = data_NYC)
# define a regression model for recent movers
lm(formula = MedianConRent ~ NewComers_pct, data = data_NYC)
# add model for new housing
ggplot(data = data_NYC,
aes(x = NewHomes_pct, y = MedianConRent)) +
geom_point(color = "green", alpha = .5) +
geom_smooth(method = "lm",  # use y ~ x
level = 0.95,   # confidence interval around the line
color = "red"
) +
labs(
title = "Does new construction relate to median rent?",
y = "Median Contract Rent ($)",
x = "New Homes as percent of market"
)
# create a scatterplot for recent movers
ggplot(data = data_NYC, aes(x = NewComers_pct, y = MedianConRent)) +
geom_point(color = "purple", alpha = .5) +
geom_smooth(method = "lm",  # use y ~ x
level = 0.95,   # confidence interval around the line
color = "orange"
) +
labs(
title = "Does in-migration relate to median rent?",
y = "Median Contract Rent ($)",
x = "Recently Moved In (%)"
)
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1750,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 90,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1750,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 45,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1750,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 0,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1850,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 0,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1900,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 0,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = 1) +
geom_text(aes(x = 1950,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 0,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
# histogram of rent
ggplot(data = data, aes(x = MedianConRent)) +
geom_histogram(binwidth = 50, fill = "red",color = "gray50") +
geom_vline(aes(xintercept = 1742),
color = "blue",
linetype = "dashed",
size = .75) +
geom_text(aes(x = 1950,
label = "Brooklyn",
y = 300),
color = "blue",
angle = 0,
vjust = 1.5) +
labs(
title = "Median Contract Rent by County, 2023", # add text
caption = "Source: ACS 5 Year Estimates",
x = "Rent ($)",
y  = "Counties"
) +
theme_minimal()  # choose a theme
